# 原文
[QUIC](https://tools.ietf.org/html/draft-hamilton-early-deployment-quic-00)

# 2. 协定和一些定义 #
QUIC使用的所有整型数值都使用小端字节序而非网络序，包括长度值，版本号，类型等。QUIC对于动态大小的数据帧的类型，在内存排布上不需要强制对其。  

以下是文章中使用的一些术语：  

- 客户端：QUIC连接的发起者终端。  
- 服务端：接受到来的QUIC连接的终端。  
- 终端：一个客户端或者服务端的连接。  
- 流：在QUIC连接中传递的双向数据的流动。  
- 连接：两个QUIC终端的会话，多种流将使用同一种加密方法。  
- 连接ID：QUIC连接的标识符。  
- QUIC包：一个可以被接受端解析的合法的UDP载荷。本文档中QUIC包大小可以参考UDP载荷大小。  

# 3. QUIC综述 #
这里我们要描述QUIC的主要机制和优势。QUIC机制上类似TCP+TLS+HTTP/2，但是是基于UDP的实现。QUIC和TCP+TLS+HTTP/2相比，优势如下：  

- 连接建立的延迟  
- 灵活的拥塞控制  
- 消除了head-of-line blocking的多路复用。[[HOL](https://en.wikipedia.org/wiki/Head-of-line_blocking)]  
- 经认证且加密的消息头和载荷  
- 流和连接的流量控制  
- 连接迁移  

## 3.1 连接建立的延迟 ##
QUIC合并了加密和传输握手，降低了不少建立加密连接所需要的消息交互来回次数。传统的TCP+TLS在发送数据之前需要经历1-3个来回的信息交互(注：这里应该包括了TLS交换密钥的握手和TCP的三次握手)，与之相比，QUIC连接一般是0-RTT的，大部分QUIC连接，数据将被直接发送，不需要等待服务端的响应。  

QUIC使用了专用流(STREAM ID 1)来执行握手，但是具体的握手协议本文不进行描述。具体详见参考文档[2].QUIC当前的握手方式将在未来被TLS 1.3所替代。  

注：[[TLS 1.3 Zero-RTT](https://tlswg.github.io/tls13-spec/)]

## 3.2 灵活的拥塞控制 ##
QUIC拥有可扩展的拥塞控制，和TCP相比，提供了更多的信令，这让QUIC可以为拥塞控制算法提供更多的信息。当前默认的拥塞控制与TCP相同。我们正在实验一些可以替代TCP的拥塞控制算法。

举其中一个例子，我们在所有包(包括普通包和重传包)种加入了一个新的包序列号。这使得QUIC的发送方可以区分重传和普通的ACK报文，可以避免TCP的重传二义性问题(注：无法判断ACK响应的是普通包还是重传包，会影响RTT计算的精度，进而影响RTO)。QUIC的ACK报文携带了从包被接收到确认报文被发送的延迟，以及一个单调递增的包号，这些都可以提高RTT的计算精度。  

/* TODO  */  
最后，QUIC的ACK帧支持最多256个ack块，因此QUIC在重排上相较于TCP的SACK更加具有弹性(TODO....)，也可以在丢包或者乱序时候保持更多的包。同时客户端和服务端也都能更准确的知道对端的接收信息。  

## 3.3 流和连接的流量控制 ##

QUIC实现了流和连接级别的流量控制，与HTTP/2的流量控制类似。QUIC的流级别流量控制工作如下：一个QUIC接收端公布自己希望接收的最大数据偏移(注：单个连接中的多路复用，在一个数据流中，每个QUIC流具有自己的一个偏移)，当数据在某一条流中传输时，接收方发送WINDOW_UPDATE帧增加自己这条流的最大接收数据量，发送方可以相应的增加这条流上的数据发送量。  

除了每条流的流控外，QUIC还实现了连接级别的流量控制，根据接收端自己为每条连接分配的资源来限制总的buffer数量。连接级别的流量控制工作模式上和流的流量控制相同，不过分发和最大接收的字节是所有流的总和。  

类似于TCP接收窗口的自动调节，QUIC也实现了在流级别和连接级别的流量控制配额的自动调节。QUIC的自动调节会增加每一个WINDOW_UPDATE帧中的配额大小，限制发送端的速率，也可以在接收端应用速度慢的时候减少发送端的速率。  

## 3.4 多路复用 ##

基于TCP的HTTP/2会遇到HOL阻塞问题。因为HTTP/2将多个流在一个TCP单字节流抽象(注：个人理解就是一个TCP连接)，一个TCP数据段的丢失会导致所有之后的数据段在重传包到来之前被阻塞，**这里不考虑HTTP/2流被包装在之后的数据端之中。**  

因为QUIC被设计为多路复用操作，一个单独的流丢失的包所承载的数据一般只影响特定的流。每个流的帧在达到时可以被立刻分配到对应的流上，因此流没有数据丢失的时候可以持续组装并上报至应用层。

警告：QUIC当前通过HTTP/2 HPACK[[HPACK](https://tools.ietf.org/html/draft-ietf-httpbis-header-compression-06)]压缩HTTP头，这会导致HTTP头部帧的HOL。  

注：消除了HOL可能是因为流是QUIC的内容，可以对流进行区分。而TCP不识别载荷的内容。

## 3.5 可靠及加密的头部和载荷  ##

